---
title: "test"
author: "Group 1"
date: "03/09/2019"
output: html_document
---

```{r setup, include=FALSE}
pacman::p_load(spotifyr, tidygraph, billboard, Rspotify, dplyr, ggplot2, igraph, ggraph, tidyverse,tibble, graphlayouts)
```

```{r}
data(lyrics, package='billboard')
data(wiki_hot_100s, package = 'billboard')
data(spotify_track_data, package = 'billboard')

original <- as.data.frame(lyrics)

test_graph <- as_tbl_graph(lyrics) %>%
  convert(to_directed) %>%
  mutate(labels = group_label_prop(),
         cent_d = centrality_degree(mode = "all"),
         cent_out = centrality_degree(mode = "out"),
         cent_in = centrality_degree(mode = "in"),
         cent_bwtn = centrality_betweenness()) %>%
  rename('title' = name) %>%
  as.data.frame()

new_graph <- original %>%
  left_join(test_graph, by = "title") %>%
  select(title, artist, year, lyrics, labels, cent_d, cent_out, cent_in, cent_bwtn)

track_data <- spotify_track_data %>%
  rename("title" = track_name)

experimental_graph <- new_graph %>%
  left_join(track_data, by = "title")

test_graph <- wiki_hot_100s %>%
  select(no) %>%
  cbind(new_graph) %>%
  rename("rank" = no)

elvis_filter <- test_graph %>%
  select(artist, title) %>%
  group_by(artist) %>%
  filter(artist == "Elvis Presley")

elvis <- as_tbl_graph(elvis_filter)
elvis %>%
  #filter(name == "Elvis Presley") %>%
  ggraph(layout = 'stress') + 
    geom_edge_link() + 
    geom_node_point(size = 8, colour = 'steelblue') +
    geom_node_text(aes(label = name), colour = 'black', vjust = 0.4) + 
    ggtitle('Binding graphs') + 
    theme_graph()

frequent_artists <- test_graph %>%
  select(artist, title) %>%
  group_by(artist) %>%
  as_tbl_graph(directed = T) %>%
  activate(nodes) %>%
  mutate(deg = centrality_degree(mode = "all")) %>%
  filter(deg > 15)

frequent_artists %>%
  ggraph(layout = 'stress') + 
    geom_edge_link() + 
    geom_node_point(size = 8, colour = 'steelblue') +
    geom_node_text(aes(label = name), colour = 'black', vjust = 0.4) + 
    ggtitle('Frequent Artists') + 
    theme_graph()

all_data <- readRDS("data_in/all_data.rds")

awe <- all_data %>%
  select(artist, title) %>%
  as_tbl_graph() %>%
  activate(nodes) %>%
  convert(to_undirected) %>%
  mutate(comm = group_louvain(),
         degree_cent = centrality_degree(mode = "all"),
         degree_in = centrality_degree(mode = "in"),
         degree_out = centrality_degree(mode = "out"),
         eigen = centrality_eigen()) %>%
  convert(to_directed) %>%
  rename("artist" = name) %>%
  as.data.frame()
# 
final <- all_data %>%
  left_join(awe, by = "artist")

comms <- final %>%
  filter(comm == "1")
```

```{r}
#all_data <- as.factor(all_data$artist)
#as.data.frame(all_data)
all_data$no <-as.numeric(all_data$no)
artgen <- all_data %>%
  filter(all_data$no < 11)%>%
  tally(genre) %>%
  select(no,genre, n) %>%
  as_tbl_graph()%>%
  convert(to_simple)%>%
  mutate(betweeness = centrality_degree())%>%
  as.igraph()

plot(artgen)
#write.graph(artgen, "~/Desktop/artgen.graphml", format=c("graphml"))
```

```{r}

```