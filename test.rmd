---
title: "test"
author: "Group 1"
date: "03/09/2019"
output: html_document
---

```{r setup, include=FALSE}
pacman::p_load(spotifyr, tidygraph, billboard, Rspotify, dplyr, ggplot2, igraph, ggraph, tidyverse,tibble, graphlayouts)
```

```{r}
client_id = Sys.setenv(SPOTIFY_CLIENT_ID = 'a1ab0e500cd84b2ab336c6a4eb2b3b29')
client_secret = Sys.setenv(SPOTIFY_CLIENT_SECRET = '471f70c3e1c74ed8b75ea23656b8481c')
token <- get_spotify_access_token()

playlist <- get_playlist('37IRJrV9jd0LnsFTIY83ax', fields = c("tracks.items.track.artists.name", "tracks.items.track.name"), authorization = token) %>%
  as.data.frame()

all_fields <- get_playlist('37IRJrV9jd0LnsFTIY83ax', fields = NULL, authorization = token)


```

```{r}
data(lyrics, package='billboard')
data(wiki_hot_100s, package = 'billboard')

original <- as.data.frame(lyrics)

test_graph <- as_tbl_graph(lyrics) %>%
  convert(to_directed) %>%
  mutate(labels = group_label_prop(),
         cent_d = centrality_degree(mode = "all"),
         cent_out = centrality_degree(mode = "out"),
         cent_in = centrality_degree(mode = "in"),
         cent_bwtn = centrality_betweenness()) %>%
  rename('title' = name) %>%
  as.data.frame()

new_graph <- original %>%
  left_join(test_graph, by = "title") %>%
  select(title, artist, year, lyrics, labels, cent_d, cent_out, cent_in, cent_bwtn)

test_graph <- wiki_hot_100s %>%
  select(no) %>%
  cbind(new_graph) %>%
  rename("rank" = no)

elvis_filter <- test_graph %>%
  select(artist, title) %>%
  group_by(artist) %>%
  filter(artist == "Elvis Presley")

elvis <- as_tbl_graph(elvis_filter)
elvis %>%
  #filter(name == "Elvis Presley") %>%
  ggraph(layout = 'stress') + 
    geom_edge_link() + 
    geom_node_point(size = 8, colour = 'steelblue') +
    geom_node_text(aes(label = name), colour = 'black', vjust = 0.4) + 
    ggtitle('Binding graphs') + 
    theme_graph()

frequent_artists <- test_graph %>%
  select(artist, title) %>%
  group_by(artist) %>%
  as_tbl_graph(directed = T) %>%
  activate(nodes) %>%
  mutate(deg = centrality_degree(mode = "all")) %>%
  filter(deg > 15)

frequent_artists %>%
  ggraph(layout = 'stress') + 
    geom_edge_link() + 
    geom_node_point(size = 8, colour = 'steelblue') +
    geom_node_text(aes(label = name), colour = 'black', vjust = 0.4) + 
    ggtitle('Frequent Artists') + 
    theme_graph()
```


